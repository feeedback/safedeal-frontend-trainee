(this["webpackJsonpmy-app"]=this["webpackJsonpmy-app"]||[]).push([[0],[,,,,,,,,,,,,function(e,t,n){e.exports=n(22)},,,,,function(e,t,n){},function(e,t,n){},,function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(10),c=n.n(o),l=(n(17),n(18),n(1)),s=n.n(l),m=n(2),i=n(4),u=n(5),d=n(8),p=n(7),h=(n(20),function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).getImages=function(){var e=Object(m.a)(s.a.mark((function e(t,n){var a,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(t.getImages(),{signal:n});case 3:return a=e.sent,e.next=6,a.json();case 6:return r=e.sent,e.abrupt("return",r);case 10:throw e.prev=10,e.t0=e.catch(0),e.t0;case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n){return e.apply(this,arguments)}}(),a.abortController=new AbortController,a._handleModalShow=function(e){e.preventDefault(),a.setState({isModalShown:!0,currentImageID:e.target.id})},a._handleModalHide=function(e){e.preventDefault(),a.setState({isModalShown:!1})},a.state={images:[],isModalShown:!1,currentImageID:null},a}return Object(u.a)(n,[{key:"componentDidMount",value:function(){var e=this,t=this.props.urls;this.getImages(t,this.abortController.signal).then((function(t){return e.setState({images:t})})).catch((function(e){"AbortError"!==e.name&&console.error(e)}))}},{key:"componentWillUnmount",value:function(){this.abortController.abort()}},{key:"render",value:function(){var e=this.state,t=e.images,n=e.currentImageID,a=e.isModalShown;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"Gallery",onClick:this._handleModalShow},t.map((function(e){return r.a.createElement("img",{className:"Gallery_image",key:e.id,id:e.id,src:e.url,alt:"img from gallery"})}))),a?r.a.cloneElement(this.props.children,{id:n,_handleModalHide:this._handleModalHide}):null)}}]),n}(r.a.PureComponent)),f=n(6),g=n(11),v=n(3),_=(n(21),function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).getFullImageAndComment=function(){var e=Object(m.a)(s.a.mark((function e(t,n,a){var r,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(t,{signal:a});case 3:return r=e.sent,e.next=6,r.json();case 6:return o=e.sent,e.abrupt("return",o);case 10:throw e.prev=10,e.t0=e.catch(0),e.t0;case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n,a){return e.apply(this,arguments)}}(),a.postNewCommentToImage=function(){var e=Object(m.a)(s.a.mark((function e(t,n,a){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(n,{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"},signal:a});case 3:if(204!==e.sent.status){e.next=8;break}return e.abrupt("return",!0);case 8:throw new Error("BadResponseStatus");case 9:e.next=14;break;case 11:throw e.prev=11,e.t0=e.catch(0),e.t0;case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t,n,a){return e.apply(this,arguments)}}(),a.abortController=new AbortController,a._handleAddComment=function(){var e=Object(m.a)(s.a.mark((function e(t){var n,r,o,c,l,m,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault(),n=a.state,r=n.currentImageData,o=n.form,c=r.id,l=r.comments,m=a.props.urls,i={name:o.author,comment:o.commentText},a.postNewCommentToImage(i,m.postNewCommentToImage(c),a.abortController.signal).then((function(e){var t={text:o.commentText,id:o.author,date:Date.now()};a.setState({currentImageData:Object(v.a)(Object(v.a)({},r),{},{comments:[].concat(Object(g.a)(l),[t])}),form:{author:"",commentText:""}})})).catch((function(e){"AbortError"!==e.name&&(a.setState({error:"Error: Bad server response. Try later"}),console.error(e))}));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a._handleChangeInput=function(e){var t=e.target,n=t.name,r=t.value,o=a.state.form;a.setState({form:Object(v.a)(Object(v.a)({},o),{},Object(f.a)({},n,r)),error:""})},a.state={currentImageData:{},form:{author:"",commentText:""},error:""},a}return Object(u.a)(n,[{key:"componentDidMount",value:function(){var e=this,t=this.props,n=t.id,a=t._handleModalHide,r=t.urls;window.addEventListener("keydown",(function e(t){27===t.keyCode&&(window.removeEventListener("keydown",e),a(t))})),this.getFullImageAndComment(r.getFullImageAndComment(n),this.abortController.signal).then((function(t){return e.setState({currentImageData:t})})).catch((function(e){"AbortError"!==e.name&&console.error(e)}))}},{key:"componentWillUnmount",value:function(){this.abortController.abort()}},{key:"_renderFullImage",value:function(){var e=this.state.currentImageData,t=e.id,n=e.url;return r.a.createElement("img",{className:"Modal_LargeImage",id:t,src:n,alt:"Large img"})}},{key:"_renderForm",value:function(){var e=this.state,t=e.form,n=e.error;return r.a.createElement("form",{className:"Modal_FormNewComment",name:"addComment",action:"",method:"",onSubmit:this._handleAddComment},r.a.createElement("input",{className:"Modal_FormNewComment_input",type:"text",name:"author",placeholder:"\u0412\u0430\u0448\u0435 \u0438\u043c\u044f",value:t.author,onChange:this._handleChangeInput,required:!0}),r.a.createElement("input",{className:"Modal_FormNewComment_input",type:"text",name:"commentText",placeholder:"\u0412\u0430\u0448 \u043a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439",value:t.commentText,onChange:this._handleChangeInput,required:!0}),r.a.createElement("input",{className:"Modal_FormNewComment_input Modal_FormNewComment_submit",type:"submit",value:"\u041e\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u043a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439"}),""!==n?r.a.createElement("span",{className:"Modal_FormNewComment_error"},n):null)}},{key:"_renderComments",value:function(){var e=this.state.currentImageData.comments,t=void 0===e?[]:e;return r.a.createElement("section",{className:"Modal_Comments"},t.map((function(e){var t=e.id,n=e.text,a=e.date;return r.a.createElement("div",{key:a,id:t,className:"Modal_Comments_commentWrapper"},r.a.createElement("p",{className:"Modal_Comments_p Modal_Comments_date"},new Date(a).toLocaleDateString("ru-RU")),r.a.createElement("p",{className:"Modal_Comments_p"},n))})))}},{key:"render",value:function(){var e=this.props._handleModalHide;return r.a.createElement("div",{id:"ModalWindow",className:"Modal"},r.a.createElement("div",{className:"Modal_contentWrapper"},this._renderFullImage(),this._renderComments(),this._renderForm(),r.a.createElement("a",{href:"",title:"\u0417\u0430\u043a\u0440\u044b\u0442\u044c",className:"Modal_closeButton",onClick:e})),r.a.createElement("a",{href:"",className:"Modal_blurFullWindow",onClick:e}))}}]),n}(r.a.Component)),w={getImages:function(){return"https://boiling-refuge-66454.herokuapp.com/images"},getFullImageAndComment:function(e){return"https://boiling-refuge-66454.herokuapp.com/images/".concat(e)},postNewCommentToImage:function(e){return"https://boiling-refuge-66454.herokuapp.com/images/".concat(e,"/comments")}},b=function(e){return r.a.createElement("div",{className:"App"},r.a.createElement("header",{className:"App_header"},r.a.createElement("h1",{className:"App_header_h1"},"Test APP")),r.a.createElement("main",{className:"App_main"},r.a.createElement(h,{urls:w},r.a.createElement(_,{urls:w}))),r.a.createElement("footer",{className:"App_footer"},r.a.createElement("p",{className:"App_footer_p"},"\xa9 2018-2019")))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(b,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}],[[12,1,2]]]);
//# sourceMappingURL=main.fefa397e.chunk.js.map